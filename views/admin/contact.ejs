

<div class="overflow-y-auto h-[calc(100vh-64px)]">
  <div class="p-6">
    <div class="card table-card gap-y-6">
      <div class="card-header flex items-center justify-between">
        <h5>Contact Inquiries</h5>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="w-full text-sm">
            <thead>
              <tr class="border-b border-slate-200 dark:border-slate-600">
                <th class="text-left px-4 py-3 font-semibold text-slate-900 dark:text-white">ID</th>
                <th class="text-left px-4 py-3 font-semibold text-slate-900 dark:text-white">Inquiry Type</th>
                <th class="text-left px-4 py-3 font-semibold text-slate-900 dark:text-white">Full Name</th>
                <th class="text-left px-4 py-3 font-semibold text-slate-900 dark:text-white">Email</th>
                <th class="text-left px-4 py-3 font-semibold text-slate-900 dark:text-white">Phone</th>
                <th class="text-left px-4 py-3 font-semibold text-slate-900 dark:text-white">Subject</th>
                <th class="text-left px-4 py-3 font-semibold text-slate-900 dark:text-white">Message</th>
                <th class="text-center px-4 py-3 font-semibold text-slate-900 dark:text-white">Actions</th>
              </tr>
            </thead>
            <tbody>
              <% if (contacts && contacts.length > 0) { %>
                <% contacts.forEach((contact, i) => { %>
                  <tr class="border-b border-slate-200 dark:border-slate-600 hover:bg-slate-50 dark:hover:bg-slate-700 transition-colors">
                    <td class="px-4 py-3 text-slate-700 dark:text-slate-300">
                      <span class="font-semibold">#<%= (currentPage - 1) * contactsPerPage + i + 1 %></span>
                    </td>
                    <td class="px-4 py-3 text-slate-700 dark:text-slate-300">
                      <span class="badge bg-blue-100 text-blue-800 text-xs"><%= contact.inquiry_type %></span>
                    </td>
                    <td class="px-4 py-3 text-slate-700 dark:text-slate-300">
                      <h6 class="font-semibold"><%= contact.full_name %></h6>
                    </td>
                    <td class="px-4 py-3 text-slate-700 dark:text-slate-300">
                      <span class="text-xs"><%= contact.email %></span>
                    </td>
                    <td class="px-4 py-3 text-slate-700 dark:text-slate-300">
                      <span class="text-xs"><%= contact.phone %></span>
                    </td>
                    <td class="px-4 py-3 text-slate-700 dark:text-slate-300">
                      <span class="text-xs font-semibold"><%= contact.subject %></span>
                    </td>
                    <td class="px-4 py-3 text-slate-700 dark:text-slate-300">
                      <span class="text-xs truncate max-w-xs block"><%= contact.message %></span>
                    </td>
                    <td class="px-4 py-3 text-center">
                      <div class="flex items-center justify-center gap-2">
                        <button class="view-contact-btn text-green-500 hover:text-green-700 transition" title="View" data-contact-id="<%= contact.id %>" data-inquiry-type="<%= contact.inquiry_type %>" data-full-name="<%= contact.full_name %>" data-email="<%= contact.email %>" data-phone="<%= contact.phone %>" data-subject="<%= contact.subject %>" data-message="<%= contact.message %>">
                          <i class="fas fa-eye text-sm"></i>
                        </button>
                        <button class="text-red-500 hover:text-red-700 transition delete-contact-btn" title="Delete" data-contact-id="<%= contact.id %>">
                          <i class="fas fa-trash text-sm"></i>
                        </button>
                      </div>
                    </td>
                  </tr>
                <% }); %>
              <% } else { %>
                <tr>
                  <td colspan="8" class="px-4 py-8 text-center text-slate-500 dark:text-slate-400">
                    <i class="fas fa-inbox text-2xl mb-2"></i>
                    <p>No contact inquiries yet.</p>
                  </td>
                </tr>
              <% } %>
            </tbody>
          </table>
        </div>

        <!-- Pagination Controls -->
        <div class="flex items-center justify-between mt-6 px-4 py-4 border-t border-slate-200 dark:border-slate-600">
          <div class="text-sm text-slate-600 dark:text-slate-400">
            Showing <span class="font-semibold"><%= contacts && contacts.length > 0 ? (currentPage - 1) * contactsPerPage + 1 : 0 %></span> 
            to <span class="font-semibold"><%= Math.min(currentPage * contactsPerPage, totalContacts) %></span> 
            of <span class="font-semibold"><%= totalContacts %></span> inquiries
          </div>

          <div class="flex items-center gap-2">
            <% if (currentPage > 1) { %>
              <a href="/admin/admin_contact?page=<%= currentPage - 1 %>" class="px-3 py-2 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded hover:bg-slate-200 dark:hover:bg-slate-600 transition flex items-center gap-2">
                <i class="fas fa-chevron-left text-sm"></i>
                Previous
              </a>
            <% } else { %>
              <button disabled class="px-3 py-2 bg-slate-100 dark:bg-slate-700 text-slate-400 dark:text-slate-600 rounded cursor-not-allowed opacity-50 flex items-center gap-2">
                <i class="fas fa-chevron-left text-sm"></i>
                Previous
              </button>
            <% } %>

            <div class="flex items-center gap-1">
              <% for (let i = 1; i <= totalPages; i++) { %>
                <% if (i === currentPage) { %>
                  <button disabled class="w-8 h-8 flex items-center justify-center bg-blue-500 text-white rounded font-semibold">
                    <%= i %>
                  </button>
                <% } else { %>
                  <a href="/admin/admin_contact?page=<%= i %>" class="w-8 h-8 flex items-center justify-center bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded hover:bg-slate-200 dark:hover:bg-slate-600 transition font-semibold">
                    <%= i %>
                  </a>
                <% } %>
              <% } %>
            </div>

            <% if (currentPage < totalPages) { %>
              <a href="/admin/admin_contact?page=<%= currentPage + 1 %>" class="px-3 py-2 bg-slate-100 dark:bg-slate-700 text-slate-700 dark:text-slate-300 rounded hover:bg-slate-200 dark:hover:bg-slate-600 transition flex items-center gap-2">
                Next
                <i class="fas fa-chevron-right text-sm"></i>
              </a>
            <% } else { %>
              <button disabled class="px-3 py-2 bg-slate-100 dark:bg-slate-700 text-slate-400 dark:text-slate-600 rounded cursor-not-allowed opacity-50 flex items-center gap-2">
                Next
                <i class="fas fa-chevron-right text-sm"></i>
              </button>
            <% } %>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Contact Details Modal -->
<div id="contactModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4" style="display: none;">
  <div class="bg-white dark:bg-slate-800 rounded-lg shadow-lg max-w-2xl w-full max-h-[90vh] flex flex-col">
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800">
      <h3 class="text-xl font-semibold text-slate-900 dark:text-white">Contact Inquiry Details</h3>
      <button class="close-contact-modal text-slate-500 hover:text-slate-700 dark:text-slate-400 dark:hover:text-slate-300 transition">
        <i class="fas fa-times text-xl"></i>
      </button>
    </div>

    <!-- Modal Body (Scrollable) -->
    <div class="flex-1 overflow-y-auto p-6 space-y-4">
      <div>
        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Inquiry Type</label>
        <p id="modalInquiryType" class="text-slate-900 dark:text-white font-medium"></p>
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Full Name</label>
        <p id="modalFullName" class="text-slate-900 dark:text-white font-medium"></p>
      </div>

      <div class="grid grid-cols-2 gap-4">
        <div>
          <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Email</label>
          <p id="modalEmail" class="text-slate-900 dark:text-white font-medium"></p>
        </div>
        <div>
          <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Phone</label>
          <p id="modalPhone" class="text-slate-900 dark:text-white font-medium"></p>
        </div>
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Subject</label>
        <p id="modalSubject" class="text-slate-900 dark:text-white font-medium"></p>
      </div>

      <div>
        <label class="block text-sm font-semibold text-slate-700 dark:text-slate-300 mb-2">Message</label>
        <p id="modalMessage" class="text-slate-700 dark:text-slate-300 leading-relaxed whitespace-pre-wrap"></p>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="flex items-center justify-end gap-3 p-6 border-t border-slate-200 dark:border-slate-700 bg-white dark:bg-slate-800">
      <button class="close-contact-modal px-4 py-2 text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition">
        Close
      </button>
    </div>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteContactModal" style="display: none;" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
  <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl w-full max-w-sm">
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-6 border-b border-slate-200 dark:border-slate-700">
      <h2 class="text-xl font-bold text-slate-900 dark:text-white flex items-center gap-2">
        <i class="fas fa-exclamation-triangle text-red-500"></i>
        Delete Inquiry
      </h2>
    </div>

    <!-- Modal Body -->
    <div class="p-6">
      <p class="text-slate-700 dark:text-slate-300 mb-2">
        Are you sure you want to delete this contact inquiry?
      </p>
      <p id="deleteContactName" class="text-sm font-semibold text-slate-600 dark:text-slate-400 bg-slate-100 dark:bg-slate-700 p-3 rounded">
        <!-- Contact name will be inserted here -->
      </p>
      <p class="text-xs text-slate-500 dark:text-slate-400 mt-3">
        <i class="fas fa-info-circle mr-1"></i>
        This action cannot be undone.
      </p>
    </div>

    <!-- Modal Footer -->
    <div class="flex items-center justify-end gap-3 p-6 border-t border-slate-200 dark:border-slate-700">
      <button id="cancelDeleteContactBtn" class="px-4 py-2 text-slate-700 dark:text-slate-300 bg-slate-100 dark:bg-slate-700 hover:bg-slate-200 dark:hover:bg-slate-600 rounded transition">
        Cancel
      </button>
      <button id="confirmDeleteContactBtn" class="px-4 py-2 text-white bg-red-500 hover:bg-red-600 rounded transition flex items-center gap-2">
        <i class="fas fa-trash"></i>
        Delete Inquiry
      </button>
    </div>
  </div>
</div>

<!-- Sidebar Toggle Script -->
<script src="/js/sidebar-toggle.js"></script>

<!-- Contact Modal Script -->
<script>
  // Contact Details Modal
  const contactModal = document.getElementById('contactModal');
  const viewContactButtons = document.querySelectorAll('.view-contact-btn');
  const closeContactModalButtons = document.querySelectorAll('.close-contact-modal');

  function openContactModal(data) {
    document.getElementById('modalInquiryType').textContent = data.inquiry_type;
    document.getElementById('modalFullName').textContent = data.full_name;
    document.getElementById('modalEmail').textContent = data.email;
    document.getElementById('modalPhone').textContent = data.phone;
    document.getElementById('modalSubject').textContent = data.subject;
    document.getElementById('modalMessage').textContent = data.message;
    contactModal.style.display = 'flex';
  }

  function closeContactModalFunc() {
    contactModal.style.display = 'none';
  }

  viewContactButtons.forEach(btn => {
    btn.addEventListener('click', (e) => {
      e.preventDefault();
      const data = {
        inquiry_type: btn.dataset.inquiryType,
        full_name: btn.dataset.fullName,
        email: btn.dataset.email,
        phone: btn.dataset.phone,
        subject: btn.dataset.subject,
        message: btn.dataset.message
      };
      openContactModal(data);
    });
  });

  closeContactModalButtons.forEach(btn => {
    btn.addEventListener('click', closeContactModalFunc);
  });

  contactModal.addEventListener('click', (e) => {
    if (e.target === contactModal) {
      closeContactModalFunc();
    }
  });

  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && contactModal.style.display === 'flex') {
      closeContactModalFunc();
    }
  });

  // Delete Contact Modal
  const deleteContactModal = document.getElementById('deleteContactModal');
  const deleteContactButtons = document.querySelectorAll('.delete-contact-btn');
  const cancelDeleteContactBtn = document.getElementById('cancelDeleteContactBtn');
  const confirmDeleteContactBtn = document.getElementById('confirmDeleteContactBtn');
  const deleteContactName = document.getElementById('deleteContactName');
  let contactToDeleteId = null;

  if (deleteContactModal) {
    deleteContactButtons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        const contactId = btn.dataset.contactId;
        const contactName = btn.closest('tr').querySelector('h6').textContent;
        
        contactToDeleteId = contactId;
        deleteContactName.textContent = contactName;
        deleteContactModal.style.display = 'flex';
      });
    });

    cancelDeleteContactBtn.addEventListener('click', () => {
      deleteContactModal.style.display = 'none';
      contactToDeleteId = null;
    });

    deleteContactModal.addEventListener('click', (e) => {
      if (e.target === deleteContactModal) {
        deleteContactModal.style.display = 'none';
        contactToDeleteId = null;
      }
    });

    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && deleteContactModal.style.display === 'flex') {
        deleteContactModal.style.display = 'none';
        contactToDeleteId = null;
      }
    });

    confirmDeleteContactBtn.addEventListener('click', async () => {
      if (!contactToDeleteId) return;

      try {
        const response = await fetch(`/contact/${contactToDeleteId}`, {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        const result = await response.json();

        if (result.success) {
          alert('Contact inquiry deleted successfully!');
          deleteContactModal.style.display = 'none';
          contactToDeleteId = null;
          
          setTimeout(() => {
            location.reload();
          }, 500);
        } else {
          alert('Error: ' + result.message);
        }
      } catch (error) {
        console.error('Error deleting contact inquiry:', error);
        alert('Error deleting contact inquiry. Please try again.');
      }
    });
  }
</script>